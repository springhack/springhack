



<p><span style="font-size:12px; white-space: pre;">	</span><span style="font-size:16px;">其实早就知道这个漏洞，只是一直懒得去看看去研究。最近正在进行的项目刚好需要用到WebView，所以特别关注了一下。在腾讯安全应急响应中心的“<span style="color: rgb(51, 51, 51); font-family: 微软雅黑, Tahoma, 宋体; line-height: 18px;"><a href="http://security.tencent.com/index.php/opensource/detail/1" target="_blank">Android WebView挂马漏洞检测工具</a></span><span style="color: rgb(51, 51, 51); line-height: 18px;">” 上有注明其原理：</span></span></p><p><span style="font-size:12px;"><span style="color: rgb(51, 51, 51); line-height: 18px;"><span style="color: rgb(51, 51, 51); font-family: 微软雅黑, Tahoma, 宋体; font-size: 14px; line-height: 18px;"><span style="white-space:pre">	</span>在安卓WebView 组件中存在 addJavascriptInterface 方法，主要用于将Java类或方法导出以供JavaScript调用。但是，JavaScript在调用导出的Java类时，可通过反射执行任意JAVA代码。典型的攻击场景：通过受影响的app发送恶意构造页面的URL，用户点击打开URL后，会执行恶意代码。比如某安卓应用使用addJavascriptInterface 方法提供以下接口：</span><br style="color: rgb(51, 51, 51); font-family: 微软雅黑, Tahoma, 宋体; font-size: 14px; line-height: 18px;" /></span></span><pre class="cs" style="margin-top: 0px; margin-bottom: 0px; padding: 0px; color: rgb(51, 51, 51); font-size: 14px; line-height: 18px;"><code class="javascript" style="display: block; padding: 0.5em; background-color: rgb(71, 73, 73); color: rgb(209, 217, 225);"><span class="keyword" style="color: rgb(204, 153, 204);"><span style="white-space:pre">	</span>this</span>.b.addJavascriptInterface(<span class="keyword" style="color: rgb(204, 153, 204);">new</span> fz(<span class="keyword" style="color: rgb(204, 153, 204);">this</span>, <span class="keyword" style="color: rgb(204, 153, 204);">null</span>), <span class="string" style="color: rgb(138, 190, 183);">&quot;js_class_name&quot;</span>);</code></pre><span style="color: rgb(51, 51, 51); font-family: 微软雅黑, Tahoma, 宋体; font-size: 14px; line-height: 18px;"><span style="white-space:pre">	</span>那么可构造恶意html页面，然后通过JavaScript调用该接口来执行系统命令：</span><br style="color: rgb(51, 51, 51); font-family: 微软雅黑, Tahoma, 宋体; font-size: 14px; line-height: 18px;" /><a href="http://drops.wooyun.org/papers/548" style="color: rgb(0, 46, 140); text-decoration: none; font-family: 微软雅黑, Tahoma, 宋体; font-size: 14px; line-height: 18px;"></a><pre class="cs" style="margin-top: 0px; margin-bottom: 0px; padding: 0px; color: rgb(51, 51, 51); font-size: 14px; line-height: 18px;"><code class="java" style="display: block; padding: 0.5em; background-color: rgb(71, 73, 73); color: rgb(209, 217, 225);"><span style="white-space:pre">	</span>js_class_name.getClass().forName(<span class="string" style="color: rgb(138, 190, 183);">&quot;java.lang.Runtime&quot;</span>).getMethod(<span class="string" style="color: rgb(138, 190, 183);">&quot;getRuntime&quot;</span>,<span class="keyword" style="color: rgb(204, 153, 204);">null</span>).invoke(<span class="keyword" style="color: rgb(204, 153, 204);">null</span>,<span class="keyword" style="color: rgb(204, 153, 204);">null</span>).exec(cmdArgs);</code></pre><br style="color: rgb(51, 51, 51); font-family: 微软雅黑, Tahoma, 宋体; font-size: 14px; line-height: 18px;" /><br style="color: rgb(51, 51, 51); font-family: 微软雅黑, Tahoma, 宋体; font-size: 14px; line-height: 18px;" /><span style="color: rgb(51, 51, 51); font-family: 微软雅黑, Tahoma, 宋体; font-size: 14px; line-height: 18px;"><span style="font-size: 18px;">修复方案：</span></span></p><p style="margin: 0px; padding: 0px; color: rgb(51, 51, 51); font-family: 微软雅黑, Tahoma, 宋体; font-size: 14px; line-height: 18px;"><span style="white-space:pre">	</span>1、如果无需与JS交互，请删除对addJavascriptInterface函数的调用；</p><p style="margin: 0px; padding: 0px; color: rgb(51, 51, 51); font-family: 微软雅黑, Tahoma, 宋体; font-size: 14px; line-height: 18px;"><span style="white-space:pre">	</span>2、在载入页面时对URL进行白名单判定，只有存在白名单中的域才允许导出或调用相关的Java类或方法；</p><p style="margin: 0px; padding: 0px; color: rgb(51, 51, 51); font-family: 微软雅黑, Tahoma, 宋体; font-size: 14px; line-height: 18px;"><br /></p><p style="margin: 0px; padding: 0px; color: rgb(51, 51, 51); font-family: 微软雅黑, Tahoma, 宋体; font-size: 14px; line-height: 18px;"><br /></p><p style="margin: 0px; padding: 0px; color: rgb(51, 51, 51); font-family: 微软雅黑, Tahoma, 宋体; font-size: 14px; line-height: 18px;">未来要写几个App，也许还会利用这个漏洞，来实现一些功能（当然要有白名单限制）。</p><br />