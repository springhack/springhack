---
layout: post
filename: zheng-huo-xin-wan-ju-，-ban-DIY-yi-ge-wan-zhao-ruan-lu-you
title: 整活新玩具，半 DIY 一个万兆软路由
categories:
  - code
  - life
description: N100 + 双万兆，性价比直逼 R86s-N
keywords: n100, r86s, r86s-n, 82599es
---
## 目的

> 其实就是玩，本身家里机柜已经上了万兆的服务器，想要折腾直接虚拟化一个就好了，但是我本人是拒绝 `AIO` 的，也不用纠结哪个方案好，整活从来不看这个嘛

## 如何 DIY 呢

> 这个经过十分的曲折，我先列出我用的材料，后面再说坑

1. 畅网 `N100` 小主机，有 `PCIe 3.0 x4` 通道的那款，毕竟通道是扩展的基础
2. `x520-da2/sr2` 网卡，双口的，这里是最坑的地方，下文细说
3. `NVMe` 转 `PCIe` 的转接卡，本身机器带了一个 `sata` 供电线，所以找额外供电是 `sata` 接口的最方便，不需要额外的电源
4. 内存条和 `SD` 卡，够用就行，软路由嘛，不需要很高性能的 `IO` 所以直接 `SD` 卡开机

> 拼装如图：

![](/uploads/20230804-104004.jpeg)

> 效果如图(懒得开机，BIOS 里一样看，能识别到就 ok 了)：

![](/uploads/20230804-103957.jpeg)

## 本身的限制

1. `PCIe 3.0 x4` 是 `8GT/s x4`，但是 `82599ES` 芯片组都是 `PCIe 2.1` 的，受影响下总带宽其实只有 `20GT/s`，理论上两个口同时跑是跑不满的，但是宽带的场景一个上行一个下行，在全双工加持下是没有问题的，不过这个还是要测一下，我懒得测试了(因为我们没有万兆的宽带T_T)
2. 机器有 `2.5GbE x4` 和一个 `WiFi` 的插槽，每个占用一条通道，所以占满了所有通道，机器也就没有 `USB 3.0` 可用，不过我觉着我的目标是软路由嘛，也用不上
3. 形状诡异，看看后面改造一个外壳试试

## 踩坑

> 踩坑分两方面：外部因素和技术踩坑

1. 家里有 `cx341a` 魔改双口，和一张四口 `2.5GbE` 网卡，接上去之后前者压根识别不到，后者只能识别到 `PCI Bridge` 设备，这个现象我以前在其他机器上见过，当时觉得是因为 `PCI Bridge` 之间不兼容导致的
2. 借了一张 `x520-sr2`，山寨的那种，不识别
3. 不死心，闪送了一张 `x520-sr2`，这张识别了，后面我研究了下可能是和 `eeprom` 有关，不过这方面我也不是很懂，但是也算是提醒了下，这玩意别乱买，整不好不兼容就亏钱啊，奉劝想要复现我这个玩意的人慎重选择从哪儿买
4. 天气原因，毕竟这阵子北京大暴雨，我的转接线之类的都卡在路上了(中通嘛，京南转运中心直接淹了)
5. 钱的问题，只是想整活而已，也不想花特别多的钱

## 成本/差别

> 我是对照着 `R86s-N` 这款新机器来的，差别有四个：

1. 没有 `WiFi/BT`，但是我觉得不是必要，想要有加点块装一个就行
2. 硬盘没有，`R86s-N` 是 `eMMC`，其实和 `SD` 卡用起来一样
3. `2.5GbE` 网口比他多一个
4. 没有 `USB 3.0` 接口，但是对我并不重要，可以在 `WiFi/BT` 和 `USB 3.0` 两者间取舍一下，因为还有额外的 `PCIe 3.0 x1` 可以用
5. 总价格，大概在 `1300` 上下，对比起来我觉得超值

> `R86s-N` 的淘宝截图

## 猜测

1. 这个 `N100` 型号，`BIOS` 似乎可以魔改自由分配通道，这点我也没法确定，但是官方确实提供了几个预置的 `BIOS` 可刷，我也测了下在 `BIOS` 里对通道可以自由的开启关闭
2. 感觉 `R86s-N` 不用 `cx341a` 换成 `x520-sr2` 的原因，和我踩的坑可能多少有点关系，毕竟前者特别便宜，没理由换呀
3. 我的猜测不负责哦

![](/uploads/20230804-105428.jpeg)
